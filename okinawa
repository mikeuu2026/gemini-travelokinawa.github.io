<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ²–ç¹© 6 å¤© 5 å¤œç²¾æº–è‡ªé§•è¡Œç¨‹è¡¨</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        /* Custom scrollbar for cleaner look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            height: 250px;
            margin: 0 auto;
        }
        .timeline-line {
            position: absolute;
            left: 24px;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e2e8f0;
            z-index: 0;
        }
        .card-hover:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
    </style>
    <!-- Chosen Palette: Ocean Breeze (Teal/Blue/Sand/Coral) -->
    <!-- Application Structure Plan: 
         1. Header: Trip Overview
         2. Dashboard Grid (4 columns now): Flight, Car Rental, **NEW: Travel Tools (Currency & Translate)**, Trip Balance Chart.
         3. Main Content: Tabbed Daily Itinerary with filtering. **NEW: Google Maps deep links added to each location**.
         4. Footer: Important Reservations.
         Rationale: Added a "Travel Tools" card at the top so the user can easily pull out their phone and convert currency while shopping without losing their place in the itinerary.
    -->
    <!-- Visualization & Content Choices:
         - Currency Converter: Interactive HTML inputs with Vanilla JS bidrectional calculation. Justification: Fast, offline-capable calculation.
         - Navigation Links: URL encoding `https://www.google.com/maps/search/?api=1&query=` attached to location data. Justification: Native integration with user's phone map app.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-slate-50 text-slate-800 font-sans antialiased selection:bg-teal-200 selection:text-teal-900 pb-20">

    <!-- Navigation / Header -->
    <header class="bg-white shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-2">
                <span class="text-2xl">ğŸŒ´</span>
                <h1 class="text-xl font-bold text-slate-800 tracking-tight">æ²–ç¹©ç²¾æº–è‡ªé§•åŠ©ç†</h1>
            </div>
            <div class="text-sm font-medium text-slate-500">
                2026/03/28 - 04/02
            </div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        
        <!-- Dashboard Grid -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8">
            
            <!-- Travel Tools Card (NEW) -->
            <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 card-hover transition-all duration-300 lg:col-span-2 row-span-2 flex flex-col">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider">ğŸ§° å¯¦ç”¨æ—…éŠå·¥å…·</h3>
                    <span class="px-2 py-1 bg-teal-100 text-teal-700 text-xs font-bold rounded">ç†è²¡é”äººå°ˆç”¨</span>
                </div>
                
                <!-- Currency Converter -->
                <div class="bg-slate-50 rounded-lg p-4 mb-4 border border-slate-200">
                    <div class="flex justify-between items-center mb-2">
                        <h4 class="font-bold text-sm text-slate-700">ğŸ’± å³æ™‚åŒ¯ç‡æ›ç®—</h4>
                        <div class="text-xs text-slate-500 flex items-center gap-1">
                            åŒ¯ç‡: <input type="number" id="rateInput" value="0.215" step="0.001" class="w-16 px-1 py-0.5 border rounded text-right bg-white">
                        </div>
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="relative flex-1">
                            <span class="absolute left-3 top-2 text-slate-400 font-bold">Â¥</span>
                            <input type="number" id="jpyInput" placeholder="è¼¸å…¥æ—¥å¹£" class="w-full pl-8 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none transition-shadow text-lg font-bold text-slate-700">
                        </div>
                        <span class="text-slate-400 font-bold">ğŸŸ°</span>
                        <div class="relative flex-1">
                            <span class="absolute left-3 top-2 text-slate-400 font-bold">NT$</span>
                            <input type="number" id="twdInput" placeholder="å°å¹£é‡‘é¡" class="w-full pl-12 pr-3 py-2 border border-slate-300 rounded-lg focus:ring-2 focus:ring-teal-500 outline-none transition-shadow text-lg font-bold text-slate-700">
                        </div>
                    </div>
                </div>

                <!-- Translation Links -->
                <div class="grid grid-cols-2 gap-3 mt-auto">
                    <a href="https://translate.google.com/?sl=zh-TW&tl=ja&op=translate" target="_blank" class="flex flex-col items-center justify-center p-3 bg-blue-50 hover:bg-blue-100 rounded-lg border border-blue-100 transition-colors">
                        <span class="text-2xl mb-1">ğŸ—£ï¸</span>
                        <span class="text-xs font-bold text-blue-700">Google ç¿»è­¯</span>
                    </a>
                    <button onclick="alert('å¯¦ç”¨èªéŒ„ï¼š\n\n1. çµå¸³ï¼šãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™ (Okaikei o onegaishimasu)\n2. å…ç¨…ï¼šå…ç¨ã§ãã¾ã™ã‹ï¼Ÿ (Menzei dekimasu ka?)\n3. è¬è¬ï¼šã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ (Arigatou gozaimasu)')" class="flex flex-col items-center justify-center p-3 bg-indigo-50 hover:bg-indigo-100 rounded-lg border border-indigo-100 transition-colors">
                        <span class="text-2xl mb-1">ğŸ“</span>
                        <span class="text-xs font-bold text-indigo-700">ç”Ÿå­˜æ—¥èªå¡</span>
                    </button>
                </div>
            </div>

            <!-- Flight Card -->
            <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 card-hover transition-all duration-300">
                <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-3">âœˆï¸ èˆªç­ (VZ568 / MM927)</h3>
                <div class="space-y-3">
                    <div class="flex justify-between items-center text-sm">
                        <div class="font-bold text-slate-800">TPE 14:45</div>
                        <div class="text-slate-400 text-xs">3/28 å»ç¨‹ ğŸ›«</div>
                        <div class="font-bold text-slate-800">17:05 OKA</div>
                    </div>
                    <div class="border-t border-slate-100 pt-2 flex justify-between items-center text-sm">
                        <div class="font-bold text-slate-800">OKA 13:15</div>
                        <div class="text-slate-400 text-xs">ğŸ›¬ 4/02 å›ç¨‹</div>
                        <div class="font-bold text-slate-800">13:50 TPE</div>
                    </div>
                </div>
            </div>

            <!-- Car Rental Widget -->
            <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 card-hover transition-all duration-300">
                <div class="flex justify-between items-start mb-1">
                    <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider">ğŸš— ç§Ÿè»Šæª”æœŸ</h3>
                </div>
                <div class="relative pt-4 pb-1">
                    <div class="flex justify-between text-xs font-bold text-slate-700 mb-1">
                        <span>3/29 10:00</span>
                        <span class="text-red-500">3/31 17:00 æ­¸é‚„</span>
                    </div>
                    <div class="h-3 bg-slate-100 rounded-full overflow-hidden">
                        <div class="h-full bg-teal-500 w-full shadow-inner"></div>
                    </div>
                </div>
            </div>

            <!-- Trip Balance Chart -->
            <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100 card-hover transition-all duration-300 lg:col-span-2 flex flex-col">
                <h3 class="text-sm font-semibold text-slate-500 uppercase tracking-wider mb-2">ğŸ“Š è¡Œç¨‹æ¯”é‡ (æ¨‚åœ’/è³¼ç‰©/ç¾é£Ÿ)</h3>
                <div class="chart-container flex-1">
                    <canvas id="tripChart"></canvas>
                </div>
            </div>

        </section>

        <!-- Main Interaction Area: Itinerary -->
        <section class="bg-white rounded-2xl shadow-lg border border-slate-100 overflow-hidden mb-8">
            
            <!-- Day Tabs -->
            <div class="flex overflow-x-auto border-b border-slate-200" id="dayTabs">
                <!-- JavaScript will populate this -->
            </div>

            <!-- Toolbar -->
            <div class="p-4 bg-slate-50 border-b border-slate-200 flex flex-wrap gap-3 items-center justify-between">
                <div class="text-sm font-bold text-slate-700" id="currentDateDisplay">
                    <!-- Date will go here -->
                </div>
                <div class="flex gap-2">
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border border-slate-300 bg-white hover:bg-slate-50 transition-colors active-filter" data-filter="all">å…¨éƒ¨</button>
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border border-slate-300 bg-white hover:bg-slate-50 transition-colors" data-filter="spot">ğŸ¡ æ™¯é»/æ¨‚åœ’</button>
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border border-slate-300 bg-white hover:bg-slate-50 transition-colors" data-filter="shop">ğŸ›ï¸ è³¼ç‰©</button>
                    <button class="filter-btn px-3 py-1.5 rounded-full text-xs font-medium border border-slate-300 bg-white hover:bg-slate-50 transition-colors" data-filter="food">ğŸ½ï¸ ç¾é£Ÿ</button>
                </div>
            </div>

            <!-- Content Area -->
            <div class="p-6 min-h-[400px] relative">
                <div id="itineraryContent" class="space-y-6 relative pl-6">
                    <!-- Timeline Line -->
                    <div class="timeline-line"></div>
                    <!-- JavaScript will populate items here -->
                </div>
            </div>
        </section>

        <!-- Important Reservation Section -->
        <section>
            <h2 class="text-xl font-bold text-slate-800 mb-4">ğŸ“Œ é‡é»é ç´„èˆ‡ä½å®¿</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                
                <!-- Dinner Reservation -->
                <div class="bg-slate-800 rounded-xl p-5 text-white shadow-md relative overflow-hidden">
                    <div class="absolute -right-4 -bottom-4 opacity-20 text-8xl">ğŸ¥©</div>
                    <div class="relative z-10">
                        <div class="flex items-center justify-between mb-2">
                            <span class="bg-red-500 text-white text-xs font-bold px-2 py-0.5 rounded">MUST EAT</span>
                            <a href="https://www.google.com/maps/search/?api=1&query=Yakiniku+Ko-chan+Nago" target="_blank" class="bg-white/20 hover:bg-white/30 px-2 py-1 rounded text-xs transition-colors flex items-center gap-1">ğŸ“ å°èˆª</a>
                        </div>
                        <h3 class="text-xl font-bold mb-1">ç„¼è‚‰ã“ã†ã¡ã‚ƒã‚“ (åè­·)</h3>
                        <p class="text-slate-300 text-xs mb-3">Day 3 (3/30) 18:30 | é›™äººå¥—é¤</p>
                        <div class="bg-white/10 rounded-lg p-3 border border-white/10 grid grid-cols-2 gap-2 text-sm">
                            <div><span class="text-slate-400 text-xs block">é ç´„è™Ÿç¢¼</span><span class="font-mono font-bold text-yellow-400">DYDYZCU8ZQ</span></div>
                            <div><span class="text-slate-400 text-xs block">é ç´„å¤§å</span><span class="font-bold">YU WENCHUNG</span></div>
                        </div>
                    </div>
                </div>

                <!-- Hotel Info -->
                <div class="bg-white rounded-xl p-5 shadow-sm border border-slate-100">
                    <h3 class="font-bold text-slate-800 mb-3">ğŸ¨ ä½å®¿å®‰æ’</h3>
                    <div class="space-y-3 text-sm">
                        <div class="flex items-start gap-3 pb-2 border-b border-slate-100">
                            <div class="bg-blue-100 text-blue-600 w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs shrink-0">1,4,5</div>
                            <div class="flex-1">
                                <div class="font-bold text-slate-800 flex justify-between">é‚£éœ¸æ­Œç”ºé˜¿çˆ¾è’™ç‰¹ <a href="https://www.google.com/maps/search/?api=1&query=Almont+Hotel+Naha+Omoromachi" target="_blank" class="text-blue-500 hover:underline text-xs">ğŸ“</a></div>
                                <div class="text-xs text-slate-500 mt-1">Day 1, 4, 5 (å…±3æ™š) | é›¢DFSèˆ‡è»Šç«™è¿‘</div>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="bg-teal-100 text-teal-600 w-8 h-8 rounded-full flex items-center justify-center font-bold text-xs shrink-0">2,3</div>
                            <div class="flex-1">
                                <div class="font-bold text-slate-800 flex justify-between">æ²–ç¹©åè­·è¶…ç´šé£¯åº— <a href="https://www.google.com/maps/search/?api=1&query=Super+Hotel+Okinawa+Nago" target="_blank" class="text-blue-500 hover:underline text-xs">ğŸ“</a></div>
                                <div class="text-xs text-slate-500 mt-1">Day 2, 3 (å…±2æ™š) | åŒ—éƒ¨å‹•ç·šæ ¸å¿ƒ</div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </section>

    </main>

    <script>
        // --- Data Structure (Updated with Map Queries) ---
        const itineraryData = [
            {
                day: 1, date: "3/28 (å…­)", title: "æŠµé”é‚£éœ¸ï¼Œè¼•é¬†å®‰é “",
                activities: [
                    { time: "14:45", title: "èµ·é£›", type: "transport", desc: "VZ568 æ¡ƒåœ’ TPE -> é‚£éœ¸ OKA", icon: "âœˆï¸" },
                    { time: "17:05", title: "æŠµé”æ²–ç¹©", type: "transport", desc: "å…¥å¢ƒã€æ­å–®è»Œé›»è»Šè‡³æ­Œç”ºç«™", icon: "ğŸ›¬", mapQuery: "Omoromachi Station Okinawa" },
                    { time: "19:00", title: "é£¯åº— Check-in", type: "stay", desc: "é‚£éœ¸æ­Œç”ºé˜¿çˆ¾è’™ç‰¹é£¯åº—", icon: "ğŸ¨", mapQuery: "Almont Hotel Naha Omoromachi" },
                    { time: "19:30", title: "æ™šé¤èˆ‡æ¡è²·", type: "food", desc: "San-A é‚£éœ¸ Main Place è¶…å¸‚æ¡è²·é£²æ–™é›¶é£Ÿ", icon: "ğŸ±", mapQuery: "San-A Naha Main Place" }
                ]
            },
            {
                day: 2, date: "3/29 (æ—¥)", title: "å–è»Šå‡ºç™¼ï¼ç¾å¼é¢¨æƒ…èˆ‡ç”Ÿæ…‹",
                activities: [
                    { time: "10:00", title: "ğŸŒŸ å–è»Šå‡ºç™¼", type: "transport", desc: "æ­Œç”ºç‡Ÿæ¥­æ‰€å–è»Š", icon: "ğŸš—", highlight: true, mapQuery: "Orix Rent a car Omoromachi" },
                    { time: "11:00", title: "ç¾åœ‹æ‘", type: "spot", desc: "æ„Ÿå—ç¾å¼åŠ å·æ°›åœï¼Œæ‹ç…§æ‰“å¡", icon: "ğŸ¡", mapQuery: "American Village Okinawa" },
                    { time: "12:30", title: "åˆé¤", type: "food", desc: "å¡”å¯é£¯ æˆ– ç¾å¼æ¼¢å ¡", icon: "ğŸ”" },
                    { time: "14:30", title: "Neo Park åè­·è‡ªç„¶å‹•æ¤ç‰©å…¬åœ’", type: "spot", desc: "è¿‘è·é›¢èˆ‡ç¦½é³¥å‹•ç‰©äº’å‹•", icon: "ğŸ¦š", mapQuery: "Neo Park Okinawa" },
                    { time: "17:00", title: "é£¯åº— Check-in", type: "stay", desc: "æ²–ç¹©åè­·è¶…ç´šé£¯åº— (é€£ä½å…©æ™š)", icon: "ğŸ¨", mapQuery: "Super Hotel Okinawa Nago" },
                    { time: "18:00", title: "æ™šé¤", type: "food", desc: "åè­·å¸‚å€å±…é…’å±‹æˆ–æš–æš®æ‹‰éºµ", icon: "ğŸœ", mapQuery: "Nago City Okinawa" }
                ]
            },
            {
                day: 3, date: "3/30 (ä¸€)", title: "æ¨‚åœ’å¤§ä¸²é€£ & é ‚ç´šå’Œç‰›",
                activities: [
                    { time: "09:30", title: "åè­·é³³æ¢¨åœ’", type: "spot", desc: "æ­ä¹˜é³³æ¢¨éŠåœ’è»Šï¼Œè©¦åƒé³³æ¢¨é»å¿ƒ", icon: "ğŸ", mapQuery: "Nago Pineapple Park" },
                    { time: "11:30", title: "OKINAWA æ°´æœæ¨‚åœ’", type: "spot", desc: "ç†±å¸¶æ°´æœé«”é©—èˆ‡è§£è¬éŠæˆ²", icon: "ğŸ¥­", mapQuery: "OKINAWA Fruits Land" },
                    { time: "13:00", title: "åˆé¤", type: "food", desc: "ç™¾å¹´å¤å®¶ å¤§å®¶ (Ufuya) æˆ–æ²–ç¹©éºµ", icon: "ğŸœ", mapQuery: "Ufuya Nago" },
                    { time: "15:00", title: "DINO æé¾ PARK", type: "spot", desc: "å°‹æ‰¾æé¾ï¼Œè²·ç´…èŠ‹å¡”ä¼´æ‰‹ç¦®", icon: "ğŸ¦–", mapQuery: "DINO Dinosaur PARK Yanbaru Subtropical Forest" },
                    { time: "18:30", title: "ğŸŒŸ æ™šé¤ï¼šç„¼è‚‰ã“ã†ã¡ã‚ƒã‚“", type: "food", desc: "é»‘æ¯›å’Œç‰›é›™äººå¥—é¤ (é ç´„è™Ÿ: DYDYZCU8ZQ)", icon: "ğŸ¥©", highlight: true, mapQuery: "Yakiniku Ko-chan Nago" }
                ]
            },
            {
                day: 4, date: "3/31 (äºŒ)", title: "é˜ä¹³çŸ³æ´ã€æ¤ç‰©åœ’èˆ‡çˆ†è²·",
                activities: [
                    { time: "09:00", title: "é€€æˆ¿å—ä¸‹", type: "transport", desc: "é›¢é–‹åè­·å¾€æ±æµ·å²¸", icon: "ğŸš—" },
                    { time: "10:00", title: "é‡‘æ­¦è§€éŸ³å¯º & æ—¥ç§€æ´", type: "spot", desc: "å¤è€å¯ºå»Ÿèˆ‡é˜ä¹³çŸ³æ´ç©´åƒè¨ª", icon: "â›©ï¸", mapQuery: "Kin Kannonji" },
                    { time: "11:30", title: "æ±å—æ¤ç‰©æ¨‚åœ’", type: "spot", desc: "äºæ­·å±±å¤§æ¤°å­æ—èˆ‡æ°´è±šäº’å‹•", icon: "ğŸŒ´", mapQuery: "Southeast Botanical Gardens Okinawa" },
                    { time: "14:00", title: "PARCO CITY", type: "shop", desc: "æœ€å¤§æµ·å²¸è³¼ç‰©ä¸­å¿ƒï¼é›†ä¸­æ¡è²·å…ç¨…å“", icon: "ğŸ›ï¸", highlight: true, mapQuery: "San-A Urasoe West Coast PARCO CITY" },
                    { time: "16:15", title: "âš ï¸ æº–å‚™é›¢é–‹å•†å ´", type: "transport", desc: "æ³¨æ„æ™‚é–“ï¼Œæº–å‚™é–‹è»Šå›æ­Œç”º", icon: "â°" },
                    { time: "17:00", title: "é‚„è»Š", type: "transport", desc: "æŠµé”æ­Œç”ºç‡Ÿæ¥­æ‰€é‚„è»Š", icon: "ğŸ", mapQuery: "Orix Rent a car Omoromachi" },
                    { time: "18:30", title: "æ™šé¤", type: "food", desc: "åœ‹éš›é€šå•†åœˆæ•£æ­¥è¦“é£Ÿ", icon: "ğŸ²", mapQuery: "Kokusai Dori Okinawa" }
                ]
            },
            {
                day: 5, date: "4/01 (ä¸‰)", title: "é‚£éœ¸æ·±åº¦éŠèˆ‡è³ªæ„Ÿç”Ÿæ´»",
                activities: [
                    { time: "10:00", title: "é¦–é‡ŒåŸå…¬åœ’", type: "spot", desc: "æ„Ÿå—ç‰çƒæ­·å²åº•è˜Š", icon: "ğŸ¯", mapQuery: "Shurijo Castle" },
                    { time: "12:30", title: "ç‰§å¿—å…¬è¨­å¸‚å ´", type: "food", desc: "é«˜CPå€¼æµ·é®®ï¼Œä¸€æ¨“è²·æ–™äºŒæ¨“ç…®", icon: "ğŸŸ", mapQuery: "Makishi Public Market" },
                    { time: "14:30", title: "å£ºå±‹é€š", type: "shop", desc: "é™¶ç“·è¡—æ•£æ­¥ï¼ŒæŒ‘é¸è³ªæ„Ÿé¸ç‰©", icon: "ğŸº", mapQuery: "Tsuboya Yachimun Street" },
                    { time: "16:00", title: "DFS æ²–ç¹© T Galleria", type: "shop", desc: "å…ç¨…ç²¾å“ï¼Œå–å’–å•¡è¦†ç›¤æŠ•è³‡æ”¶ç›Š", icon: "ğŸ’³", mapQuery: "T Galleria by DFS, Okinawa" },
                    { time: "18:30", title: "æœ€å¾Œæ™šé¤", type: "food", desc: "æ–°éƒ½å¿ƒè³ªæ„Ÿå±…é…’å±‹", icon: "ğŸ»", mapQuery: "Omoromachi Okinawa" }
                ]
            },
            {
                day: 6, date: "4/02 (å››)", title: "æ»¿è¼‰è€Œæ­¸",
                activities: [
                    { time: "10:15", title: "å‰å¾€æ©Ÿå ´", type: "transport", desc: "æ­å–®è»Œè‡³é‚£éœ¸æ©Ÿå ´", icon: "ğŸš†", mapQuery: "Naha Airport" },
                    { time: "10:45", title: "åœ‹å…§ç·šèˆªå»ˆ", type: "shop", desc: "æœ€å¾Œè¡åˆºï¼ä¼´æ‰‹ç¦®æ¬¾å¼æœ€å¤š", icon: "ğŸ" },
                    { time: "13:15", title: "å›ç¨‹èµ·é£›", type: "transport", desc: "MM927 é‚£éœ¸ OKA -> æ¡ƒåœ’ TPE", icon: "ğŸ›«" }
                ]
            }
        ];

        let state = { currentDay: 0, filter: 'all' };
        const dayTabsContainer = document.getElementById('dayTabs');
        const itineraryContent = document.getElementById('itineraryContent');
        const currentDateDisplay = document.getElementById('currentDateDisplay');
        const filterButtons = document.querySelectorAll('.filter-btn');

        // --- Currency Logic ---
        const jpyInput = document.getElementById('jpyInput');
        const twdInput = document.getElementById('twdInput');
        const rateInput = document.getElementById('rateInput');

        function calculateCurrency(source) {
            const rate = parseFloat(rateInput.value) || 0.215;
            if (source === 'jpy') {
                const jpy = parseFloat(jpyInput.value) || 0;
                twdInput.value = Math.round(jpy * rate);
            } else if (source === 'twd') {
                const twd = parseFloat(twdInput.value) || 0;
                jpyInput.value = Math.round(twd / rate);
            } else if (source === 'rate') {
                if(jpyInput.value) calculateCurrency('jpy');
            }
        }
        jpyInput.addEventListener('input', () => calculateCurrency('jpy'));
        twdInput.addEventListener('input', () => calculateCurrency('twd'));
        rateInput.addEventListener('input', () => calculateCurrency('rate'));


        // --- Itinerary Logic ---
        function renderTabs() {
            dayTabsContainer.innerHTML = '';
            itineraryData.forEach((day, index) => {
                const btn = document.createElement('button');
                const isActive = index === state.currentDay;
                btn.className = `flex-none px-5 py-3 text-sm transition-colors border-b-2 whitespace-nowrap ${isActive ? 'border-teal-500 text-teal-700 bg-teal-50/50' : 'border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-50'}`;
                btn.innerHTML = `<div class="font-bold">Day ${day.day}</div><div class="text-xs opacity-80">${day.date.split(' ')[0]}</div>`;
                btn.onclick = () => { state.currentDay = index; renderTabs(); renderItinerary(); };
                dayTabsContainer.appendChild(btn);
            });
        }

        function renderItinerary() {
            const dayData = itineraryData[state.currentDay];
            currentDateDisplay.textContent = `${dayData.date} - ${dayData.title}`;
            
            const filteredActivities = dayData.activities.filter(act => state.filter === 'all' || act.type === state.filter);
            itineraryContent.innerHTML = '<div class="timeline-line"></div>'; 

            if (filteredActivities.length === 0) {
                itineraryContent.innerHTML += `<div class="pl-12 py-10 text-slate-400 italic text-sm">æ­¤åˆ†é¡ä¸‹ç„¡æ´»å‹•ã€‚</div>`;
                return;
            }

            filteredActivities.forEach(act => {
                const item = document.createElement('div');
                item.className = 'relative flex gap-4 items-start group animate-fade-in';
                
                let iconColorClass = "bg-slate-100 text-slate-500";
                if (act.type === 'food') iconColorClass = "bg-orange-100 text-orange-600";
                if (act.type === 'shop') iconColorClass = "bg-pink-100 text-pink-600";
                if (act.type === 'spot') iconColorClass = "bg-teal-100 text-teal-600";
                if (act.type === 'transport') iconColorClass = "bg-blue-100 text-blue-600";
                if (act.type === 'stay') iconColorClass = "bg-indigo-100 text-indigo-600";

                const highlightClass = act.highlight ? "border-amber-200 bg-amber-50/30" : "border-slate-100 bg-white";
                
                // Map Link Generator
                const mapLink = act.mapQuery 
                    ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(act.mapQuery)}" target="_blank" class="text-blue-500 hover:text-blue-700 bg-blue-50 hover:bg-blue-100 px-2 py-0.5 rounded text-xs transition-colors flex items-center gap-1 border border-blue-100">ğŸ“ å°èˆª</a>` 
                    : '';

                item.innerHTML = `
                    <div class="z-10 flex-none w-10 h-10 rounded-full ${iconColorClass} flex items-center justify-center text-lg shadow-sm border-2 border-white mt-1">
                        ${act.icon}
                    </div>
                    <div class="flex-1 p-3 rounded-xl border ${highlightClass} shadow-sm card-hover transition-all">
                        <div class="flex justify-between items-start mb-1 gap-2">
                            <h4 class="font-bold text-slate-800 text-sm md:text-base leading-tight">${act.title}</h4>
                            <div class="flex items-center gap-2 shrink-0">
                                ${mapLink}
                                <span class="text-xs font-mono font-medium text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded">${act.time}</span>
                            </div>
                        </div>
                        <p class="text-xs md:text-sm text-slate-600 leading-relaxed mt-1">${act.desc}</p>
                    </div>
                `;
                itineraryContent.appendChild(item);
            });
        }

        filterButtons.forEach(btn => {
            btn.addEventListener('click', (e) => {
                filterButtons.forEach(b => b.classList.remove('bg-teal-600', 'text-white', 'border-transparent'));
                e.target.classList.add('bg-teal-600', 'text-white', 'border-transparent');
                state.filter = e.target.dataset.filter;
                renderItinerary();
            });
        });
        document.querySelector('[data-filter="all"]').classList.add('bg-teal-600', 'text-white', 'border-transparent');

        // --- Chart.js ---
        function initChart() {
            const ctx = document.getElementById('tripChart').getContext('2d');
            let counts = { spot: 0, food: 0, shop: 0 };
            itineraryData.forEach(day => day.activities.forEach(act => { if (counts[act.type] !== undefined) counts[act.type]++; }));

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['æ¨‚åœ’/æ™¯é»', 'è³¼ç‰©å…ç¨…', 'ç¾é£Ÿé¥—å®´'],
                    datasets: [{
                        data: [counts.spot, counts.shop, counts.food],
                        backgroundColor: ['#0d9488', '#db2777', '#f97316'],
                        borderWidth: 0, hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { legend: { position: 'right', labels: { usePointStyle: true, boxWidth: 8, font: {size: 11} } } },
                    layout: { padding: 10 }
                }
            });
        }

        window.addEventListener('DOMContentLoaded', () => {
            renderTabs();
            renderItinerary();
            initChart();
        });
    </script>
</body>
</html>
